# BeerMap

# Why this project

**BeerMap은 이동중에도 맛난 브루어리를 쉽게 찾고 싶다는 개인적인 바람에서 시작했습니다.  
사용자는 이 서비스에서 주소나 매장 이름을 검색해서 브루어리 정보를 찾을 수 있습니다.**

# System Overview

![canvas_service-flow-231006_0148](https://github.com/hamelln/beermap-client/assets/39308313/e29d0036-f9e1-44ff-befa-05230e6e5f69)

# Live Demo

**[사이트로 이동](https://beermap.vercel.app/)**

# Screenshots

![Frame 34](https://github.com/hamelln/beermap-client/assets/39308313/545364d9-ec5e-4f52-bf23-1c6964c41d08)

# Skills & Tools

![제목 없음2](https://github.com/hamelln/beermap-client/assets/39308313/b1765337-ce4a-4404-872c-70b7a1ad2d96)

# Challenges & Solutions

### 모바일의 모달 상호작용

[문제]
- 모바일 기기에서는 사용자가 뒤로 가기 버튼으로 모달 창을 닫는 경우가 많은데 이는 데스크탑과 사뭇 다릅니다. 이에 대처를 안 해서 뒤로 가기로 페이지 이동 시 화면이 고정되거나 기능이 멈추는 side effect가 발생했습니다.
- 게다가 dialog는 열리기 전에도 내부 컴포넌트를 렌더링하므로 리소스를 소모합니다. 지도 API 요청 낭비를 유발할 뿐더러, API가 위치를 중심을 잘못 잡고 렌더링하는 side effect도 발생합니다.

[접근]
- 처음엔 상태관리로 dialog를 활성화, 비활성화하는 방식을 사용했지만, 상태 변경의 비동기적 실행 순서가 dialog의 원활한 작동을 방해했습니다.
- 상태로 모달을 여닫는 대신 라우터로 URI를 인식해서 모달을 여닫도록 변경하고, 모달이 열릴 때에만 내부 컴포넌트가 렌더링되도록 바꿔 해결했습니다.

### FCP 개선

[문제]
- 기존에는 상세 페이지 탐색 시간이 3초를 초과했습니다. 이는 사용 경험을 매우 저하시키는 요소입니다.

[접근]
- 캐러셀의 첫 번째 이미지는 브루어리의 외관으로 고정하도록 패턴화하고 배포 서버에 static하게 저장했다가 응답하도록 바꿨습니다.
- 이미지들을 WebP로 경량화하고 Cloudinary를 통해 더 최적화한 이미지를 가져오도록 변경했습니다.
- 바로 보이지 않을 이미지는 lazy loading을 적용했습니다.
- SSR 방식에서 ISR 방식으로 변경했습니다. 현재는 회원 가입, 리뷰 작성 등의 기능을 지원하지 않기 때문에 SSR로 구현할 필요가 없다고 판단했습니다.
- 이를 통해 FCP를 3초 대에서 1초 대로 단축했습니다.

### 선 개발, 후 테스트

[문제]
- 테스트는 빠르면 좋지만, 늦어도 해야 합니다. BeerMap은 가볍게 시작했지만 2개월 차에 접어들자 테스트가 필요하다고 판단했습니다.

[접근]
- Jest: 컴포넌트 구조가 의존성이 많은지, 경계에 대한 처리를 했는지(검색어 길이를 무한대로 허용하는지, 검색어가 없을 때 어떻게 할지 등) 파악하고 대처할 수 있었습니다.
- Storybook: 컴포넌트의 UI를 독립적으로 보고 의도한 바와 다르게 렌더링되는지 금방 확인할 수 있었습니다.
- Cypress: 서비스를 켜고 직접 모든 기능을 사용하고 검사하는 과정을 자동화했습니다.
- MSW: Storybook과 Jest 동시에 mocking을 지원할 뿐더러, fetch API mocking, Stub 준비에 들어가는 비용을 좀 더 절감할 수 있었습니다.

### 크로스 브라우징 대처

[문제]
- 크로스 브라우징을 확인하기 위해 일일이 다른 환경으로 체크하는 것은 비용이 많이 소모됩니다.

[접근]
- ResponsivelyApp은 여러 환경에서 동시에 실행함으로 크로스 브라우징을 빠르게 점검합니다.
- 일부 구형 iPhone에서 Cloudinary가 auto 설정으로 제공하는 이미지의 확장자를 로드하지 못하는 현상을 일찍 발견하고 수정했습니다.

# Key Learnings & Insights

### 트레이드 오프
> 1. 지도 API 변경: 구글맵 API는 사용이 편하지만 무료 사용량이 적고, 네이버 지도 API는 사용이 불편하지만 무료 사용량이 매우 많습니다. 처음에는 구글맵 API를 사용했지만, 현재는 네이버 지도 API로 변경했습니다. 길찾기 기능도 네이버를 사용하기 때문에 일관성을 유지하기 좋다고 판단했습니다.
> 2. 테스트 도입: 테스트를 도입하지 않아도 기능은 정상적으로 작동했습니다. 테스트가 익숙하지 않아 테스트 환경 설정에도 시간이 걸렸습니다. 사용해본 적 없는 Storybook과 Cypress를 도입하는 것도 고민이 들었지만, 각 테스트는 그만한 학습 비용을 낼 가치가 충분하다고 느꼈고, 테스트를 안 할 때에는 놓쳤던 구조적 문제(의존성, 경계) 등을 금방 찾을 수 있었을 뿐더러 코드에 대한 자신감도 높아졌습니다.
> 3. 타입스크립트 학습: 처음에는 프로젝트에 간단한 타이핑만 하되 타입 에러를 구글링해서 해결했습니다. 이런 임시 방편으론 타입스크립트를 쓰는 의미가 희미하다고 판단했고, 매주 목요일 밤에 시간을 내서 스터디를 하며 타입스크립트 코드를 리팩토링합니다.

### 사용자 피드백
> 주기적으로 주변 사람들에게 사용 피드백을 부탁했고, 만드는 데에 수고가 들었던 바텀 시트를 모달로 교체하는 등 중요한 UX 결정을 내릴 수 있었습니다.

### 코드 품질
> 매일 청소하듯이 작은 리팩토링을 하며 가독성이 좋은 코드, 커밋, 작문을 학습중입니다.

### 관점의 확장
> 백엔드 개발과 디자인을 겸했고, 서버 측 HTTP 통신에 대한 이해, 웹 표준에 따른 UI/UX 학습 등을 통해 프론트엔드에만 국한됐던 관점이 좀 더 넓어졌습니다.

### 테스트 고찰
> "무엇을 테스트할 것인가?" 이러한 질문은 코드를 구조적으로, 다각도로 접근하도록 만듭니다.  
특히 사용자의 동작에 초점을 맞춰서 테스트하되, 테스트 코드 또한 가독성을 좋게 만들어야겠다는 생각을 다시금 했습니다.

# Code Conventions

- Magic number 금지. 의미있는 변수 사용.
- boolean형 식별자는 is, has, are 등의 접두사 붙이기.
- 식별자 이름은 길더라도 구체적이고 의미가 명료하기.
- 함수는 작게 작성.(하나의 함수가 여러 동작을 실행 X)
- 함수 로직이 다르면 다른 패턴으로 작명.
예: HTTP 요청으로 데이터를 가져오면 fetchData, 다른 방법으로 가져오면 getData.
- typing은 자동 추론이 미흡할 경우에 작성.
- type, interface 이름은 간결하게.
예: Brewery
- 컴포넌트 이름은 자세하게.
예: BreweryDetails

# Changelog

## 2023/10

### Fixes
- 검색 페이지 검색어 길이 30으로 제한 (10/3)
- 서비스 상세 페이지 접속 에러 해결: 배포 서버의 MSW 실행 차단 (10/3)

### Changes
- CI 추가, UI 테스트, E2E 테스트 추가, 검색 페이지 가로 너비 치우침 수정 (10/4)
- 통합 테스트 추가 (10/3)

## 2023/9

### Fixes
- 모달창을 뒤로 가기 외의 방법으로 닫은 뒤엔 뒤로 가기 기능이 안 먹히는 현상 수정: 어떤 방법으로 닫아도 히스토리를 back하도록 변경 (9/8)
- 상세 페이지 진입이 안 되는 에러 수정: 로딩 컴포넌트의 이미지 경로가 잘못됨에 따라 잘못된 params.id로서 이중으로 전달됐었음 (9/7)
- 캐러셀의 실제 사진 갯수와 표시되는 숫자가 불일치하는 현상 수정 (9/6)

### Improvements
- 복잡한 줄바꿈 로직을 지우고 white-space:pre-line으로 수정 (9/7)

### Changes
- 파비콘 추가, 로딩 화면 이미지 비율과 상세 페이지 이미지 비율 동기화 (9/22)
- 로고 스타일, 캐러셀 이미지 비율, 설명글 행간 조절 (9/10)
- 다크 모드의 설명글 명도 낮춤 (9/8)

## 2023/8

### New
- 브루어리 상세 이미지 추가: Clouninary에 요청. (8/24)
- 지도에 줌인, 줌아웃 버튼 추가 (8/17)
- 구글 -> 네이버 지도로 변경. (8/16)
- 주소 복사, 길찾기 기능, 브루어리 한 줄 소개 추가 (8/16)
- 구글 지도, 바텀 시트, 주소 복사 기능, 영업 시간 추가 (8/2)

### Fixes
- 줌 버튼 오작동 현상 수정: 자체적으로 만든 줌 버튼의 연동성 부족으로 API에 내장된 줌 버튼으로 변경 (8/18)
- 상세 페이지에서 검색 페이지로 돌아올 시 이전 화면 복구 제대로 안 되는 현상 수정: 세션 스토리지 값을 바로 없애지 않고 유지하는 것으로 변경 (8/18)
- 바텀시트 삭제, 주소 클릭 시 지도 표시하는 동작으로 변경: 바텀 시트의 사용성이 안 좋았음 (8/16)
- 검색어 없으면 모든 브루어리를 표시하는 기능 추가 (8/9)
- 로딩 페이지 간소화: 로딩 시간이 애매해서 스피너가 오히려 UX 저해 (8/8)
- 모달 제대로 안 열리는 현상 수정: state로 모달 여닫는 대신 내장된 기능 이용 (8/8)
- 테마 모드 호출 코드 오류 수: useEffect 내부에서 로컬 스토리지 호출하도록 변경 (8/7)
- 콘솔 에러 수정: 세션 스토리지에 값이 있을 때에만 참조하도록 변경 (8/2)
- 주소 연속 복사 시 애니메이션 중첩 현상 수정: useDebounce 적용 (8/2)

### Improvements
- 렌더링 효율 개선: 모달 요소를 클릭할 때에만 모달 내부 컴포넌트 렌더링하도록 변경 (8/31)
- useModal 개선: 지도, 영업 시간에서 공통으로 사용할 수 있도록 범용적으로 변경, state로 여닫기 -> URI 인식으로 여닫기 (8/31)
- Cloudinary에서 최적화한 이미지 가져오도록 변경 (8/24)
- 상세페이지와 모달 로직 분리 (8/9)
- 상세 페이지 렌더링 효율 개선: 이미지 경량화(WebP), 후순위 이미지들은 lazy loading (8/8)

### Changes
- 영업 시간 닫기 버튼 스타일 수정, 정보칸 글자들 행간 수정, 이미지 화질 수정 (8/31)
- 이미지를 모바일 디바이스 width별에 맞춰서 small, medium, large로 요청하도록 변경 (8/24)
- 내 위치 찾기 클릭 시 초점이 안 맞는 현상 수정. (8/17)
- 글자 줄바꿈 적용 (8/16)
- axios -> fetch, SSR -> ISR로 변경 (8/12)
- 메인 페이지를 검색 페이지로 변경: 기존의 메인 페이지가 아무 역할이 없었음 (8/9)
- 상세 페이지의 요소 간 margin 수정 (8/9)
- 리스트 아이템 별 구분선 추가, 캐러셀 좌우 버튼 삭제, 아이콘 추가, 상세 영업 시간은 클릭 시에만 활성화 (8/2)
- 캐러셀 좌상단 화살표 부분의 배경 살짝 어둡게 조정 (8/2)

## 2023/7

### New
- 상세 페이지, 캐러셀, 아이콘 추가 및 디자인 수정, 검색 결과 캐시 기능 추가 (7/28)

### Changes
- 검색 페이지, 검색 결과 스타일 수정, normalize.css 적용 (7/28)

# Future Plans
- 데스크탑 호환성
- 브루어리 추천
- 회원 가입
- 맥주 설명 방식 업데이트
